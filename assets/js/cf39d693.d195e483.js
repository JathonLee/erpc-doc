"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8842],{1797:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"best-practices/protobuf-parameter-validation","title":"ProtoBuf \u63a5\u53e3\u53c2\u6570\u6821\u9a8c","description":"2024/9/10","source":"@site/docs/best-practices/protobuf-parameter-validation.md","sourceDirName":"best-practices","slug":"/best-practices/protobuf-parameter-validation","permalink":"/erpc-doc/docs/best-practices/protobuf-parameter-validation","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/best-practices/protobuf-parameter-validation.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"ProtoBuf \u63a5\u53e3\u53c2\u6570\u6821\u9a8c","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"\u62c6\u5206 ProtoBuf \u6587\u4ef6","permalink":"/erpc-doc/docs/best-practices/protobuf-file-splitting"},"next":{"title":"Error \u7ba1\u7406","permalink":"/erpc-doc/docs/best-practices/service-error-management"}}');var a=n(4848),o=n(8453);const i={title:"ProtoBuf \u63a5\u53e3\u53c2\u6570\u6821\u9a8c",sidebar_position:3},s="ProtoBuf \u63a5\u53e3\u53c2\u6570\u6821\u9a8c",l={},c=[{value:"\u5982\u4f55\u4f7f\u7528\uff1a",id:"\u5982\u4f55\u4f7f\u7528",level:2},{value:"1. \u5728 buf.yaml \u6dfb\u52a0 deps",id:"1-\u5728-bufyaml-\u6dfb\u52a0-deps",level:4},{value:"2. buf.gen.yaml \u6dfb\u52a0",id:"2-bufgenyaml-\u6dfb\u52a0",level:4},{value:"3. Proto \u6dfb\u52a0\u6821\u9a8c\u89c4\u5219,\u8be6\u7ec6\u89c4\u5219\u67e5\u770b\uff1a\u6821\u9a8c\u89c4\u5219",id:"3-proto-\u6dfb\u52a0\u6821\u9a8c\u89c4\u5219\u8be6\u7ec6\u89c4\u5219\u67e5\u770b\u6821\u9a8c\u89c4\u5219",level:4},{value:"4. \u751f\u6210\u4ee3\u7801",id:"4-\u751f\u6210\u4ee3\u7801",level:4},{value:"5. \u5982\u4f55\u4f7f\u7528\u6821\u9a8c\u4ee3\u7801",id:"5-\u5982\u4f55\u4f7f\u7528\u6821\u9a8c\u4ee3\u7801",level:4},{value:"\u62e6\u622a\u6548\u679c:",id:"\u62e6\u622a\u6548\u679c",level:3}];function d(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"protobuf-\u63a5\u53e3\u53c2\u6570\u6821\u9a8c",children:"ProtoBuf \u63a5\u53e3\u53c2\u6570\u6821\u9a8c"})}),"\n",(0,a.jsxs)(t.admonition,{type:"tip",children:[(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"2024/9/10"})}),(0,a.jsx)(t.p,{children:"\ud83c\udd95\u6700\u65b0 erpc new \u51fa\u6765\u7684\u9879\u76ee\u5df2\u7ecf\u4e3a\u9ed8\u8ba4\u914d\u7f6e\u884c\u4e3a,\u53ea\u9700\u8981\u5728 ProtoBuf \u6587\u4ef6\u91cc\u52a0\u6821\u9a8c\u89c4\u5219\u5373\u53ef\uff01"})]}),"\n",(0,a.jsx)(t.h2,{id:"\u5982\u4f55\u4f7f\u7528",children:"\u5982\u4f55\u4f7f\u7528\uff1a"}),"\n",(0,a.jsx)(t.h4,{id:"1-\u5728-bufyaml-\u6dfb\u52a0-deps",children:"1. \u5728 buf.yaml \u6dfb\u52a0 deps"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",metastring:'title="buf.yaml"',children:"version: v2\nlint:\n  use:\n    - DEFAULT\nbreaking:\n  use:\n    - FILE\nmodules:\n  - path: proto\ndeps:\n  - buf.build/googleapis/googleapis\n  - buf.build/bufbuild/protovalidate # \u65b0\u589e\u8be5\u884c\n"})}),"\n",(0,a.jsx)(t.h4,{id:"2-bufgenyaml-\u6dfb\u52a0",children:"2. buf.gen.yaml \u6dfb\u52a0"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",metastring:'title="buf.gen.yaml"',children:"version: v2\nmanaged:\n  enabled: true # default: false\n  disable:\n    - module: buf.build/googleapis/googleapis\n    # \u65b0\u589e\u4e0b\u9762\u914d\u7f6e\n    - file_option: go_package_prefix\n      module: buf.build/bufbuild/protovalidate\nplugins:\n  - remote: buf.build/protocolbuffers/go:v1.34.2\n    out: internal/gen/proto\n    opt: paths=source_relative\n  - remote: buf.build/grpc-ecosystem/openapiv2:v2.21.0\n    out: docs\n  - remote: buf.build/grpc/go:v1.5.1\n    out: internal/gen/proto\n    opt: paths=source_relative,require_unimplemented_servers=false\n  - remote: buf.build/grpc-ecosystem/gateway:v2.21.0\n    out: internal/gen/proto\n    opt: paths=source_relative\n"})}),"\n",(0,a.jsxs)(t.h4,{id:"3-proto-\u6dfb\u52a0\u6821\u9a8c\u89c4\u5219\u8be6\u7ec6\u89c4\u5219\u67e5\u770b\u6821\u9a8c\u89c4\u5219",children:["3. Proto \u6dfb\u52a0\u6821\u9a8c\u89c4\u5219,\u8be6\u7ec6\u89c4\u5219\u67e5\u770b\uff1a",(0,a.jsx)(t.a,{href:"https://github.com/bufbuild/protovalidate/blob/main/docs/standard-constraints.md",children:"\u6821\u9a8c\u89c4\u5219"})]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:'syntax = "proto3";\n\nimport "buf/validate/validate.proto";\n\nmessage User {\n  // User\'s name, must be at least 1 character long.\n  string name = 1 [(buf.validate.field).string.min_len = 1]; // [] \u5185\u4e3a\u6821\u9a8c\u89c4\u5219,\n}\n'})}),"\n",(0,a.jsx)(t.h4,{id:"4-\u751f\u6210\u4ee3\u7801",children:"4. \u751f\u6210\u4ee3\u7801"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"# \u5728\u9879\u76ee\u6839\u76ee\u5f55\u6267\u884c\n\nbuf dep update && erpc gen \n"})}),"\n",(0,a.jsx)(t.h4,{id:"5-\u5982\u4f55\u4f7f\u7528\u6821\u9a8c\u4ee3\u7801",children:"5. \u5982\u4f55\u4f7f\u7528\u6821\u9a8c\u4ee3\u7801"}),"\n",(0,a.jsx)(t.admonition,{type:"tip",children:(0,a.jsx)(t.p,{children:"\u8981\u6c42\uff1acontrib/server/grpc-gateway \u7248\u672c\u8981\u6c42 v0.1.9"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="/internal/server/server.go"',children:'package server\n\nfunc New(ctx context.Context, srv v1.KlMaterialOsServiceServer) server.Server {\n\treturn grpcgw.New(\n//\u5ffd\u7565\u4e2d\u95f4\u4ee3\u7801...\n\t\tgrpcgw.WithGRPCServerAddress(":"+*gport),\n\t\tgrpcgw.WithGRPCServerOptions(\n\t\t\tgrpc.ChainUnaryInterceptor(\n\t\t\t\tmiddleware.RecoverUnaryServerInterceptor(),\n\t\t\t\tmiddleware.SkywalkingUnaryServerInterceptor(),\n\t\t\t\tmiddleware.RequestLogUnaryServerInterceptor(),\n\t\t\t\tmiddleware.XESafeMetadataUnaryServerInterceptor(),\n+\t\t\t\tmiddleware.ValidatorServerInterceptor(), // \u65b0\u589e\u8be5\u4e2d\u95f4\u4ef6\n\t\t\t),\n//\u5ffd\u7565\u4e2d\u95f4\u4ee3\u7801...\n\t\t),\n\t)\n}\n'})}),"\n",(0,a.jsx)(t.h3,{id:"\u62e6\u622a\u6548\u679c",children:"\u62e6\u622a\u6548\u679c:"}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"alt text",src:n(9991).A+"",width:"534",height:"308"})}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},9991:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/Intercept-d405f5cfea333295a3c8279e78fb56cb.png"},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>s});var r=n(6540);const a={},o=r.createContext(a);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);